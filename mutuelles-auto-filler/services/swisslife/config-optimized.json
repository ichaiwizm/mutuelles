{
  "meta": {
    "service": "swisslife",
    "version": "2.0.0",
    "description": "Configuration optimisée basée sur bigtest.js",
    "lastUpdate": "2025-01-18"
  },
  "settings": {
    "defaultDelay": 100,
    "stabilizationDelay": 350,
    "maxWaitTime": 8000,
    "retryAttempts": 3,
    "debugMode": false
  },
  "workflow": [
    {
      "section": "project",
      "order": 1,
      "required": true,
      "conditions": null
    },
    {
      "section": "hospitalisation",
      "order": 2,
      "required": true,
      "conditions": null
    },
    {
      "section": "simulationType",
      "order": 3,
      "required": true,
      "conditions": null,
      "waitAfter": {
        "type": "stable",
        "minQuiet": 350,
        "maxWait": 5000
      }
    },
    {
      "section": "principalInsured", 
      "order": 4,
      "required": true,
      "conditions": null
    },
    {
      "section": "children",
      "order": 5,
      "required": false,
      "conditions": {
        "hasChildren": true
      }
    },
    {
      "section": "spouse",
      "order": 6,
      "required": false,
      "conditions": {
        "simulationType": "couple"
      },
      "waitBefore": {
        "type": "tabActivation",
        "target": "conjoint"
      }
    },
    {
      "section": "loiMadelin",
      "order": 7,
      "required": false,
      "conditions": {
        "regimeSocial": "TNS",
        "statut": "TNS"
      }
    },
    {
      "section": "cancellation",
      "order": 8,
      "required": true,
      "conditions": null
    },
    {
      "section": "competition",
      "order": 9,
      "required": true,
      "conditions": null
    }
  ],
  "sections": {
    "project": {
      "name": "Nom du projet",
      "fields": [
        {
          "id": "nom_projet",
          "type": "input",
          "required": true,
          "selectors": {
            "primary": "#nom-projet",
            "fallbacks": [
              "input[id*='nom'][id*='projet']",
              "input[name*='nomProjet']"
            ],
            "contextSearch": {
              "labelRegex": "/(votre\\s+)?nom.*projet/i",
              "sectionKeywords": ["projet", "nom"]
            }
          },
          "action": {
            "method": "setValue",
            "events": ["focus", "input", "change", "blur"]
          },
          "validation": {
            "minLength": 1,
            "maxLength": 50,
            "required": true
          },
          "dataSource": "projetNom"
        }
      ]
    },
    "hospitalisation": {
      "name": "Confort Hospitalisation",
      "fields": [
        {
          "id": "confort_hospitalisation",
          "type": "radio",
          "required": true,
          "selectors": {
            "oui": "#projet-confort-hospitalisation-oui",
            "non": "#projet-confort-hospitalisation-non"
          },
          "action": {
            "method": "clickSequence",
            "events": ["pointerdown", "mousedown", "mouseup", "click"]
          },
          "defaultValue": "non",
          "dataSource": "confortHospitalisation"
        }
      ]
    },
    "simulationType": {
      "name": "Type de simulation",
      "critical": true,
      "fields": [
        {
          "id": "type_simulation",
          "type": "radio",
          "required": true,
          "selectors": {
            "detection": {
              "radioGroup": "input[type='radio'][name]",
              "labelPatterns": {
                "individuel": "/individu/i",
                "couple": "/(couple|pour\\s+le\\s+couple)/i"
              }
            }
          },
          "action": {
            "method": "clickSequence",
            "events": ["pointerdown", "mousedown", "mouseup", "click"]
          },
          "waitAfter": {
            "type": "stable",
            "minQuiet": 350,
            "maxWait": 5000
          },
          "dataSource": "simulationType"
        }
      ]
    },
    "principalInsured": {
      "name": "Assuré Principal",
      "fields": [
        {
          "id": "date_naissance_principal",
          "type": "input",
          "required": true,
          "selectors": {
            "primary": "#date-naissance-assure-principal",
            "fallbacks": [
              "input[id*='date'][id*='naissance'][id*='principal']",
              "input[name*='dateNaissance'][name*='principal']"
            ]
          },
          "action": {
            "method": "humanType",
            "charDelay": 8,
            "events": ["focus", "input", "change", "blur"]
          },
          "validation": {
            "format": "DD/MM/YYYY",
            "regex": "^\\d{2}/\\d{2}/\\d{4}$"
          },
          "dataSource": "principalDOB"
        },
        {
          "id": "departement_principal",
          "type": "select",
          "required": true,
          "selectors": {
            "primary": "#departement-assure-principal",
            "fallbacks": [
              "#departement",
              "#departement-residence"
            ]
          },
          "action": {
            "method": "pickSelect",
            "matching": "prefix",
            "events": ["focus", "change", "blur"]
          },
          "dataSource": "cp",
          "transform": {
            "type": "prefix",
            "length": 2
          }
        },
        {
          "id": "regime_social_principal",
          "type": "select",
          "required": true,
          "selectors": {
            "primary": "#regime-social-assure-principal"
          },
          "action": {
            "method": "pickSelect",
            "matching": "exactValue",
            "events": ["focus", "change", "blur"]
          },
          "enums": [
            "SECURITE_SOCIALE",
            "SECURITE_SOCIALE_ALSACE_MOSELLE", 
            "TNS",
            "AMEXA",
            "AUTRES_REGIME_SPECIAUX"
          ],
          "aliases": {
            "CPAM": "SECURITE_SOCIALE",
            "Régime Général pour TNS (CPAM)": "TNS"
          },
          "dataSource": "regimeSocial",
          "defaultValue": "TNS"
        },
        {
          "id": "statut_principal",
          "type": "select",
          "required": true,
          "selectors": {
            "primary": "#statut-assure-principal"
          },
          "action": {
            "method": "pickSelect",
            "matching": "exactValue",
            "waitForOptions": true,
            "events": ["focus", "change", "blur"]
          },
          "enums": [
            "TNS", "RETRAITE", "SALARIE", "SALARIE_AGRICOLE", 
            "EXPLOITANT_AGRICOLE", "FONCTIONNAIRE", "ETUDIANT"
          ],
          "aliases": {
            "Travailleur Non Salarié": "TNS",
            "Chef d'entreprise": "TNS"
          },
          "dataSource": "statutTexte",
          "defaultValue": "TNS"
        },
        {
          "id": "profession_principal",
          "type": "select",
          "required": false,
          "selectors": {
            "primary": "#profession-assure-principal"
          },
          "action": {
            "method": "pickSelect",
            "matching": "exactValue",
            "waitForOptions": true,
            "waitDelay": 500,
            "events": ["focus", "change", "blur"]
          },
          "enums": [
            "MEDECIN", "CHIRURGIEN", "CHIRURGIEN_DENTISTE", 
            "PHARMACIEN", "AUXILIAIRE_MEDICAL", "AUTRE"
          ],
          "aliases": {
            "Non médicale": "AUTRE"
          },
          "dataSource": "profTexte",
          "defaultValue": "AUTRE"
        }
      ]
    },
    "children": {
      "name": "Enfants",
      "conditional": true,
      "fields": [
        {
          "id": "nombre_enfants",
          "type": "select",
          "required": true,
          "selectors": {
            "primary": "#sante-nombre-enfant-assures",
            "fallbacks": [
              "#nb-enfant-moins-20-ans"
            ]
          },
          "action": {
            "method": "pickSelect",
            "matching": "exactValue",
            "events": ["change"]
          },
          "waitAfter": {
            "type": "stable",
            "minQuiet": 350,
            "maxWait": 7000
          },
          "dataSource": "enfantsDOB",
          "transform": {
            "type": "arrayLength"
          }
        },
        {
          "id": "enfants_dates",
          "type": "inputArray",
          "required": false,
          "selectors": {
            "pattern": "#contrat-enfants-{index}-date-naissance",
            "fallbacks": [
              "#enfants-{index}-dateNaissance"
            ]
          },
          "action": {
            "method": "typeMasked",
            "charDelay": 8,
            "mode": "loose",
            "events": ["focus", "input", "change"]
          },
          "validation": {
            "format": "DD/MM/YYYY",
            "regex": "^\\d{2}/\\d{2}/\\d{4}$"
          },
          "dataSource": "enfantsDOB"
        },
        {
          "id": "enfants_ayants_droit",
          "type": "selectArray", 
          "required": false,
          "selectors": {
            "pattern": "#enfants-{index}-idAyantDroit"
          },
          "action": {
            "method": "pickSelect",
            "matching": "exactValue",
            "mode": "loose"
          },
          "enums": ["CLIENT", "CONJOINT"],
          "aliases": {
            "assuré principal": "CLIENT",
            "conjoint": "CONJOINT"
          },
          "dataSource": "enfantsAyantDroit",
          "defaultValue": "CLIENT"
        }
      ]
    },
    "spouse": {
      "name": "Conjoint",
      "conditional": true,
      "activationRequired": true,
      "tabActivation": {
        "selectors": [
          "#tab-conjoint",
          "#onglet-conjoint", 
          "a[href*='conjoint']"
        ],
        "waitAfter": {
          "type": "stable",
          "minQuiet": 300,
          "maxWait": 5000
        }
      },
      "fields": [
        {
          "id": "date_naissance_conjoint",
          "type": "input",
          "required": true,
          "selectors": {
            "primary": "#date-naissance-assure-conjoint"
          },
          "action": {
            "method": "humanType",
            "charDelay": 8,
            "events": ["focus", "input", "change", "blur"]
          },
          "validation": {
            "format": "DD/MM/YYYY",
            "regex": "^\\d{2}/\\d{2}/\\d{4}$"
          },
          "dataSource": "conjointDOB"
        },
        {
          "id": "regime_social_conjoint",
          "type": "select",
          "required": true,
          "selectors": {
            "primary": "#regime-social-assure-conjoint"
          },
          "action": {
            "method": "pickSelect",
            "matching": "exactValue",
            "waitForOptions": true,
            "events": ["focus", "change", "blur"]
          },
          "enums": [
            "SECURITE_SOCIALE",
            "SECURITE_SOCIALE_ALSACE_MOSELLE",
            "TNS", 
            "AMEXA",
            "AUTRES_REGIME_SPECIAUX"
          ],
          "dataSource": "conjointRegimeSocial",
          "defaultValue": "TNS"
        },
        {
          "id": "statut_conjoint",
          "type": "select",
          "required": true,
          "selectors": {
            "primary": "#statut-assure-conjoint"
          },
          "action": {
            "method": "pickSelect",
            "matching": "exactValue",
            "waitForOptions": true,
            "events": ["focus", "change", "blur"]
          },
          "enums": [
            "TNS", "RETRAITE", "SALARIE", "SALARIE_AGRICOLE",
            "EXPLOITANT_AGRICOLE", "FONCTIONNAIRE", "ETUDIANT"
          ],
          "dataSource": "conjointStatutTexte",
          "defaultValue": "TNS"
        },
        {
          "id": "profession_conjoint", 
          "type": "select",
          "required": false,
          "selectors": {
            "primary": "#profession-assure-conjoint"
          },
          "action": {
            "method": "pickSelect",
            "matching": "exactValue",
            "waitForOptions": true,
            "events": ["focus", "change", "blur"]
          },
          "enums": [
            "MEDECIN", "CHIRURGIEN", "CHIRURGIEN_DENTISTE",
            "PHARMACIEN", "AUXILIAIRE_MEDICAL", "AUTRE"
          ],
          "dataSource": "conjointProfTexte",
          "defaultValue": "AUTRE"
        }
      ]
    },
    "loiMadelin": {
      "name": "Loi Madelin",
      "conditional": true,
      "fields": [
        {
          "id": "loi_madelin_checkbox",
          "type": "checkbox",
          "required": false,
          "selectors": {
            "primary": "#loi-madelin-checkbox",
            "fallbacks": [
              "input[type='checkbox'][id*='madelin']",
              "input[type='checkbox'][name*='madelin']"
            ],
            "contextSearch": {
              "labelRegex": "/loi\\s+madelin/i"
            }
          },
          "action": {
            "method": "clickLabel",
            "events": ["click"]
          },
          "dataSource": "loiMadelin",
          "defaultValue": true
        }
      ]
    },
    "cancellation": {
      "name": "Résiliation de contrat",
      "fields": [
        {
          "id": "resiliation_contrat",
          "type": "radio",
          "required": true,
          "selectors": {
            "oui": "#resiliation-contrat-oui",
            "non": "#resiliation-contrat-non"
          },
          "action": {
            "method": "clickSequence", 
            "events": ["pointerdown", "mousedown", "mouseup", "click"]
          },
          "dataSource": "resiliation",
          "defaultValue": "non"
        }
      ]
    },
    "competition": {
      "name": "Reprise de concurrence",
      "fields": [
        {
          "id": "reprise_concurrence",
          "type": "radio",
          "required": true,
          "selectors": {
            "oui": "#reprise-concurrence-oui",
            "non": "#reprise-concurrence-non"
          },
          "action": {
            "method": "clickSequence",
            "events": ["pointerdown", "mousedown", "mouseup", "click"]
          },
          "dataSource": "repriseConcurrence",
          "defaultValue": "non"
        }
      ]
    }
  }
}