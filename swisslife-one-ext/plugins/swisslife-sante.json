{
  "name": "SwissLife Santé",
  "version": "1.0",
  "context": {
    "iframeName": "iFrameTarificateur",
    "routes": {
      "home": "#/accueil",
      "tarif": "#/tarification-et-simulation/slsis"
    }
  },
  "steps": [
    {
      "id": "project",
      "name": "Configuration du projet",
      "fields": {
        "nomProjet": {
          "selector": "#nom-projet",
          "type": "input",
          "required": true
        },
        "santeOui": {
          "selector": "#projet-sante-individuelle-oui",
          "type": "radio",
          "required": true
        },
        "confortNon": {
          "selector": "#projet-confort-hospitalisation-non",
          "type": "radio",
          "required": true
        },
        "simulationIndividuelle": {
          "selector": "#simulation-individuelle",
          "type": "radio",
          "condition": "data.simulationType === 'individuelle'"
        },
        "simulationCouple": {
          "selector": "#simulation-couple",
          "type": "radio",
          "condition": "data.simulationType === 'couple'"
        }
      },
      "delay": 300
    },
    {
      "id": "principal",
      "name": "Assuré principal",
      "fields": {
        "dateNaissancePrincipal": {
          "selector": "#date-naissance-assure-principal",
          "type": "input",
          "dataField": "principalDOB",
          "required": true
        },
        "departementPrincipal": {
          "selector": "#departement-assure-principal",
          "type": "select",
          "dataField": "cp",
          "transform": "extractDepartment",
          "selectByStartsWith": true
        },
        "regimeSocialPrincipal": {
          "selector": "#regime-social-assure-principal",
          "type": "select",
          "value": "Régime Général pour TNS (CPAM)",
          "retry": true
        },
        "statutPrincipal": {
          "selector": "#statut-assure-principal",
          "type": "select",
          "dataField": "statutTexte",
          "retry": true
        },
        "professionPrincipal": {
          "selector": "#profession-assure-principal",
          "type": "select",
          "dataField": "profTexte",
          "waitFor": "selectOptions",
          "retry": true
        }
      },
      "delay": 200
    },
    {
      "id": "children",
      "name": "Enfants",
      "condition": "data.enfantsDOB && data.enfantsDOB.length > 0",
      "fields": {
        "nombreEnfants": {
          "selector": "#sante-nombre-enfant-assures",
          "type": "selectByValue",
          "dataField": "enfantsDOB",
          "transform": "arrayLength"
        }
      },
      "dynamicFields": {
        "pattern": "#enfants-{index}-dateNaissance",
        "type": "input",
        "dataField": "enfantsDOB",
        "isArray": true,
        "waitAfterNombreEnfants": 800
      },
      "delay": 400
    },
    {
      "id": "spouse",
      "name": "Conjoint", 
      "condition": "data.simulationType === 'couple' && data.conjointDOB",
      "beforeAction": "triggerRecalc",
      "beforeActionDelay": 500,
      "fields": {
        "dateNaissanceConjoint": {
          "selector": "#date-naissance-assure-conjoint",
          "type": "input",
          "dataField": "conjointDOB",
          "waitFor": "element",
          "fallbackSelector": "input[name*='conjoint'][name*='naissance']"
        },
        "regimeSocialConjoint": {
          "selector": "#regime-social-assure-conjoint",
          "type": "select",
          "value": "Régime Général pour TNS (CPAM)",
          "retry": true
        },
        "statutConjoint": {
          "selector": "#statut-assure-conjoint",
          "type": "select",
          "dataField": "statutTexte",
          "retry": true
        }
      },
      "delay": 200
    },
    {
      "id": "product",
      "name": "Produit et options",
      "fields": {
        "gamme": {
          "selector": "#selection-produit-sante",
          "type": "select",
          "dataField": "gammeTexte"
        },
        "dateEffet": {
          "selector": "#contratSante-dateEffet",
          "type": "input",
          "transform": "generateEffectDate"
        },
        "loiMadelinCheckbox": {
          "selector": "#loi-madelin-checkbox",
          "type": "checkbox",
          "value": true
        },
        "resiliationNon": {
          "selector": "#resiliation-contrat-non",
          "type": "radio",
          "value": true
        }
      },
      "delay": 300
    }
  ],
  "transforms": {
    "extractDepartment": "value => (value || '').slice(0, 2)",
    "arrayLength": "value => Array.isArray(value) ? value.length : 0",
    "generateEffectDate": "() => { const today = new Date(); const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1); const pad = n => String(n).padStart(2, '0'); return `${pad(nextMonth.getDate())}/${pad(nextMonth.getMonth() + 1)}/${nextMonth.getFullYear()}`; }"
  },
  "actions": {
    "triggerRecalc": "() => { const el = document.querySelector('#date-naissance-assure-principal') || document.querySelector('#statut-assure-principal'); if (el) { el.focus(); setTimeout(() => el.blur(), 80); } }"
  }
}
